# PROTOCOL.md

## üß© –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è** –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–∏–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (GUI) –∏ Lua-–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–æ–π –ø–∞–∫–µ—Ç–∞ **–ú–æ–π–û—Ñ–∏—Å**.  
–û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç, –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–º–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞–º–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `command.log`.

---

## üî§ –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

–ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ **JSON (UTF-8)**.

```json
{"id": 1713772901001, "cmd": "SET_CELL_TEXT", "args": {"sheet": 0, "addr": "A1", "text": "–ü—Ä–∏–≤–µ—Ç"}}
```

### –ü–æ–ª—è –∫–æ–º–∞–Ω–¥—ã

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------------|-----------|
| `id` | number | –¥–∞ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–∞–Ω–¥—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ |
| `cmd` | string | –¥–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ |
| `args` | object | –¥–∞ | –ê—Ä–≥—É–º–µ–Ω—Ç—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã |

---

## üìú –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `command.log`

```
{"id": 1, "cmd": "ADD_SHEET", "args": {"name": "Demo"}}
{"id": 2, "cmd": "SET_CELL_TEXT", "args": {"sheet": 0, "addr": "A1", "text": "–ü—Ä–∏–≤–µ—Ç –∏–∑ GUI"}}
{"id": 3, "cmd": "SAVE_AS", "args": {"path": "C:/temp/demo.xlsx"}}
{"id": 999, "cmd": "EXIT", "args": {}}
```

---

## üö¶ –ü—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞.**  
   –ö–æ–º–∞–Ω–¥—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (FIFO).

2. **–§–æ—Ä–º–∞—Ç:** JSON –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –∏ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤.  

3. **–ê—Ä–≥—É–º–µ–Ω—Ç—ã (`args`)** –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç—ã: `{}`.  

4. **–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** UTF-8 –±–µ–∑ BOM.  

5. **–ö–æ–º–∞–Ω–¥–∞ `EXIT`** ‚Äî —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã GUI.  
   –ü–æ—Å–ª–µ –µ—ë –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MyOffice.

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- Lua –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è GUI.  
- –§–∞–π–ª `command.log` –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é.  
- –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ **–æ–¥–Ω–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º GUI**.  
- ?–†–∞–∑–º–µ—Ä `command.log` –¥–æ–ª–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤–Ω–µ—à–Ω–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (–æ—á–∏—Å—Ç–∫–∞/—Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).?

---

## üß± –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º (–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Äî –≤ `specs/commands.md`):

| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ê—Ä–≥—É–º–µ–Ω—Ç—ã |
|----------|-------------|-----------|
| `SAVE_AS` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥ –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º | `path` (string) |
| `SAVE` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç | ‚Äî |
| `ADD_SHEET` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ª–∏—Å—Ç | `name?`, `rows?`, `cols?` |
| `RENAME_SHEET` | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ª–∏—Å—Ç | `sheet`, `name` |
| `SET_CELL_TEXT` | –ó–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ —è—á–µ–π–∫—É | `sheet`, `addr`, `text` |
| `SET_CELL_NUMBER` | –ó–∞–ø–∏—Å–∞—Ç—å —á–∏—Å–ª–æ –≤ —è—á–µ–π–∫—É | `sheet`, `addr`, `number` |
| `SET_CELL_FORMULA` | –ó–∞–ø–∏—Å–∞—Ç—å —Ñ–æ—Ä–º—É–ª—É –≤ —è—á–µ–π–∫—É | `sheet`, `addr`, `formula` |
| `SET_RANGE_TEXT` | –ó–∞–ø–∏—Å–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π | `sheet`, `range`, `values[][]` |
| `FIND_REPLACE` | –ù–∞–π—Ç–∏ –∏ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç | `sheet`, `range?`, `find`, `replace` |
| `CREATE_FILTERS_RANGE` | –°–æ–∑–¥–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—É–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω | `sheet`, `range:{row,col,rows,cols}` |
| `SET_FILTERS` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã | `sheet`, `filters:[...]` |
| `CLEAR_FILTERS` | –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã | `sheet` |
| `EXIT` | –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É GUI –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å MyOffice | ‚Äî |

---

## üìö –ì–¥–µ —á–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ

- **[ARCHITECTURE.md](../ARCHITECTURE.md)** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–º–µ–Ω–∞ –∏ —Ä–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.  
- **[specs/commands.md](../specs/commands.md)** ‚Äî –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥.  
- **[docs/examples.md](../docs/examples.md)** ‚Äî –ø—Ä–∏–º–µ—Ä—ã `command.log` –∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.  
- **[docs/integration.md](../docs/integration.md)** ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é GUI.
