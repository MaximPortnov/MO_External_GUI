# ARCHITECTURE.md

## üß© –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É **–≤–Ω–µ—à–Ω–∏–º GUI** –∏ **Lua-–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–æ–π** –ø–∞–∫–µ—Ç–∞ **–ú–æ–π–û—Ñ–∏—Å**.  
–¶–µ–ª—å ‚Äî –æ–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏, –∫–æ–≥–¥–∞ –æ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–ª–µ–¥—É–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å.

---

## ‚öôÔ∏è –û–±—â–∞—è –∏–¥–µ—è

- GUI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–∏–∑ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏ MyOffice**.  
- –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ **–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫** –∏ –≤—Ö–æ–¥–∏—Ç –≤ **–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª**, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–ª–µ–¥–∏—Ç –∑–∞ —Ñ–∞–π–ª–æ–º `command.log`.  
- GUI —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∑–∞–ø–∏—Å—ã–≤–∞—è –∫–æ–º–∞–Ω–¥—ã –≤ —Ñ–∞–π–ª `command.log`.  
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç GUI, **–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ –ª—é–±–æ–π –ø—Ä–∏—á–∏–Ω–µ** (–≤—ã–ª–µ—Ç, –æ—à–∏–±–∫–∞, —Ä—É—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ),  
  GUI –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `EXIT`.  
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç `EXIT`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–∞–Ω–¥—ã –∏ **–≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ü–∏–∫–ª–∞**, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—è MyOffice.

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ)

1. –ù–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç GUI –∏ –≤—Ö–æ–¥–∏—Ç –≤ –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ü–∏–∫–ª.  
2. GUI –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã (–ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ JSON) –≤ —Ñ–∞–π–ª `command.log`.  
3. –ù–∞–¥—Å—Ç—Ä–æ–π–∫–∞, –Ω–∞—Ö–æ–¥—è—Å—å –≤ —Ü–∏–∫–ª–µ, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫.  
4. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —á–∏—Ç–∞–µ—Ç—Å—è, –ø–∞—Ä—Å–∏—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.  
5. –ö–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `EXIT`, –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ü–∏–∫–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MyOffice.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—á–∏—Ö —Ñ–∞–π–ª–æ–≤

```tree
getWorkingDirectory/
‚îú‚îÄ ipc/
‚îÇ  ‚îú‚îÄ command.log     ‚Üê –≤—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (JSON Lines, GUI ‚Üí Lua)
‚îÇ  ‚îî‚îÄ offset.txt      ‚Üê —á–∏—Å–ª–æ ‚Äî –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
‚îî‚îÄ logs/              ‚Üê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ª–æ–≥–∏ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**  

- `command.log` ‚Äî **–¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è** GUI: –∫–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.  
- `offset.txt` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç **–Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏**, –∞ –Ω–µ –±–∞–π—Ç–æ–≤–æ–µ —Å–º–µ—â–µ–Ω–∏–µ.  

---

## üß± –§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥ (–∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞)

–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –≤ `PROTOCOL.md` –∏ `specs/commands.md`.  
–ù–∏–∂–µ ‚Äî –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π.

```json
{"id": 1713772901001, "cmd": "SET_CELL_TEXT", "args": {"sheet": 0, "addr": "A1", "text": "–ü—Ä–∏–≤–µ—Ç"}}
{"id": 1713772901002, "cmd": "ADD_SHEET",     "args": {"name": "Demo"}}
{"id": 1713772901003, "cmd": "SAVE_AS",       "args": {"path": "C:/temp/demo.xlsx"}}
{"id": 1713772901999, "cmd": "EXIT",          "args": {}}
```

**–ü—Ä–∞–≤–∏–ª–∞:**  

- –ö–æ–º–∞–Ω–¥–∞ = –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ **JSON (UTF-8)**.  
- –ü–æ–ª—è:  
  - `id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).  
  - `cmd` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).  
  - `args` ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ; `{}` –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç).  
- –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî –ø–æ –ø–æ—Ä—è–¥–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫.

---

## üß© –†–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### GUI (–≤–Ω–µ—à–Ω–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.  
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ `‚Ä¶/ipc/command.log` –ø–æ –º–µ—Ä–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏, –≤—ã–ª–µ—Ç–µ –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –ø—Ä–∏—á–∏–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ–≥–¥–∞** –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `EXIT`.  

### Lua-–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ (–≤–Ω—É—Ç—Ä–∏ MyOffice)

- –ó–∞–ø—É—Å–∫–∞–µ—Ç GUI –∏–∑ Lua –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.  
- –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Ö–æ–¥–∏—Ç –≤ **–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª**, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π `command.log`.  
- –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã.  
- –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç `EXIT`, –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ü–∏–∫–ª–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å MyOffice.

---

## üîÅ –ú–æ–¥–µ–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏

- **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º:** –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç –∫–æ–º–∞–Ω–¥—É `EXIT`.  
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:** –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Ö –∑–∞–ø–∏—Å–∏ GUI.  
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –∫–æ–º–∞–Ω–¥–∞ `EXIT` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞.  
- **–ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ª–æ–≥ (`logs/`) –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## üì¢ –¢—Ä–∏–≥–≥–µ—Ä—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- –ö–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è **–≤ –º–æ–º–µ–Ω—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `command.log`**.  
- –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∏–≤—ë—Ç, –ø–æ–∫–∞ –∑–∞–ø—É—â–µ–Ω GUI; –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ GUI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ü–∏–∫–ª –≤ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–µ.

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞

- **–û–±–º–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É:** GUI ‚Üí Lua.  
- **Lua –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã** –∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ.  
- **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª** –æ–±—Ä–∞–±–æ—Ç–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.  
- **EXIT** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã GUI –∏ —Ü–∏–∫–ª–∞ Lua.

---

## üìö –ì–¥–µ —á–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ

- **[PROTOCOL.md](../PROTOCOL.md)** ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –æ–±–º–µ–Ω–∞.  
- **[specs/commands.md](../specs/commands.md)** ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ –∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.  
- **[docs/integration.md](../docs/integration.md)** ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GUI.  
- **[docs/troubleshooting.md](../docs/troubleshooting.md)** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Å–ø–æ—Å–æ–±–æ–≤ –∏—Ö —Ä–µ—à–µ–Ω–∏—è.  
- **[docs/examples.md](../docs/examples.md)** ‚Äî –ø—Ä–∏–º–µ—Ä—ã JSON-–∫–æ–º–∞–Ω–¥ –¥–ª—è `command.log`.  
- **[docs/lua-extension.md](../docs/lua-extension.md)** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Lua-–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã.
